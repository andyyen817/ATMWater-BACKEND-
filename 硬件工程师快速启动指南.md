# 硬件工程师快速启动指南

> **目标**: 5分钟内让ESP32设备连接到服务器并完成认证

---

## 🚀 快速开始（3步）

### 第1步：获取设备信息

联系后端开发团队，获取以下信息：

| 参数 | 示例值 | 说明 |
|------|--------|------|
| **设备ID** | `DEVICE001` | 唯一标识，需提前在数据库注册 |
| **设备密码** | `123456` | 认证密码 |
| **TCP服务器地址** | `hkg1.clusters.zeabur.com` | 生产环境 |
| **TCP端口** | `30235` | 外部端口 |

### 第2步：复制Arduino示例代码

```cpp
#include <WiFi.h>
#include <ArduinoJson.h>

// WiFi配置
const char* WIFI_SSID = "your_wifi_ssid";
const char* WIFI_PASSWORD = "your_wifi_password";

// TCP服务器配置
const char* TCP_HOST = "hkg1.clusters.zeabur.com";
const int TCP_PORT = 30235;

// 设备信息（从后端团队获取）
const char* DEVICE_ID = "DEVICE001";
const char* DEVICE_PASSWORD = "123456";

WiFiClient client;
unsigned long lastHeartbeat = 0;

void setup() {
  Serial.begin(115200);
  
  // 连接WiFi
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  Serial.println("\nWiFi connected");
  
  // 连接TCP服务器
  if (client.connect(TCP_HOST, TCP_PORT)) {
    Serial.println("TCP connected");
    
    // 发送认证
    String authMsg = "{\"Cmd\":\"AU\",\"DId\":\"" + String(DEVICE_ID) + 
                     "\",\"Pwd\":\"" + String(DEVICE_PASSWORD) + "\"}\n";
    client.print(authMsg);
    Serial.println("Sent: " + authMsg);
  }
}

void loop() {
  // 接收服务器响应
  if (client.available()) {
    String msg = client.readStringUntil('\n');
    Serial.println("Received: " + msg);
  }
  
  // 每60秒发送心跳
  if (millis() - lastHeartbeat > 60000) {
    String hbMsg = "{\"Cmd\":\"HB\",\"DId\":\"" + String(DEVICE_ID) + "\"}\n";
    client.print(hbMsg);
    Serial.println("Sent heartbeat");
    lastHeartbeat = millis();
  }
}
```

### 第3步：验证连接

1. 上传代码到ESP32
2. 打开串口监视器（115200波特率）
3. 应该看到：
   ```
   WiFi connected
   TCP connected
   Sent: {"Cmd":"AU","DId":"DEVICE001","Pwd":"123456"}
   Received: {"Cmd":"AU","Result":"OK","Msg":"Authentication successful"}
   ```

4. 访问 `https://atmwater-backend.zeabur.app/test`，确认设备在线

---

## 📚 完整文档

详细协议说明请查看：`硬件对接文档_TCP协议规范v1.0.md`

---

## 🆘 常见问题

### 连接失败？

1. 检查WiFi是否连接成功
2. 检查服务器地址和端口是否正确
3. 确认设备ID和密码已在数据库注册

### 认证失败？

1. 确认设备ID拼写正确（区分大小写）
2. 确认密码正确
3. 联系后端团队检查数据库

### 心跳超时？

1. 确保每60秒发送一次心跳
2. 检查网络是否稳定
3. 实现自动重连机制

---

## 📞 联系方式

- **技术支持**: [您的联系方式]
- **测试仪表板**: https://atmwater-backend.zeabur.app/test
- **完整文档**: 见 `硬件对接文档_TCP协议规范v1.0.md`


